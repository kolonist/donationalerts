<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Test sound</title>

        <script src="https://unpkg.com/whatwg-fetch@3.0.0/dist/fetch.umd.js"
            integrity="sha512-WNVxjXx6AYogYznJUpCFxqcUGI+vVIuMvX2i/tmX3omPWA2rHeoTgYkYYCFASuVRDK1X0/BSotIKvbwlBaFqtw=="
            crossorigin="anonymous"></script>
    </head>

    <body>
        <script>
let context;

(function init() {
    if (!window.AudioContext) {
        if (!window.webkitAudioContext) {
            console.log('Your browser does not support any AudioContext and cannot play back this audio');
            return;
        }
        window.AudioContext = window.webkitAudioContext;
    }

    context = new AudioContext();
})();

async function playByteArray(bytes) {
    const buffer = new Uint8Array(bytes.length);
    buffer.set(new Uint8Array(bytes), 0);

    const decodedData = await context.decodeAudioData(buffer.buffer);
    await play(decodedData);
}

function play(audioBuffer) {
    return new Promise((resolve, reject) => {
        const source = context.createBufferSource();
        source.buffer = audioBuffer;
        source.connect(context.destination);
        source.start();

        setTimeout(resolve, (audioBuffer.duration + 1) * 1000);
    });
}
        </script>

        <script>
/*fetch(`sound.json`)
    .then(res => res.json())
    .then(async donations => {
        for (const message of donations) {
            if ('audio' in message) {
                await playByteArray(message.audio.data);
            }
        }
    });*/
        </script>

        <script src="sound.js"></script>
        <script>
(async function() {
    for (const message of donations) {
        if ('audio' in message) {
            await playByteArray(message.audio.data);
        }
    }
})();
        </script>
    </body>
</html>
